# 拓扑排序

对于一个DAG图，其拓扑序是G中所有节点的一种线性次序，满足如下条件：如果图包含边（u,v)，则拓扑序列中u在v的前面。拓扑序列可能不唯一。

伪代码如下

```pseudocode
TOPOLOGICAL-SORT(G)
在G上运行DFS以得出每个节点的f值
在每个节点处理完成时，将它加入一个栈S的顶部
返回S
```

### 引理（DAG图的检验）：一个有向图是无环的当且仅当对其进行DFS不产生后向边

证明（证明逆否定理）：

充分性：如果DFS中产生了一条后向边(u,v)，则在深度优先森林中，v是u的祖先，因此存在v到u到一条路径，这条路径与(u,v)一起构成一条回路

必要性：假设有向图中有一个环路，设v是环路中第一个被发现的点。因为v在一个环路中，设(u,v)是环路中指向v的边。因为v是环路中第一个被发现的点，所以其他点都是白色，根据白色路径定理，u将成为v的后代，而因为存在边(u,v)，所以在处理u时会得到一条后向边。

### 定理：拓扑排序算法生成的是DAG图的拓扑排序

证明：因为拓扑序要求存在边(u,v)时u在v的前面，而算法返回的链表中f值大的在前面，因此证明定理等价于证明存在边(u,v)时u.f>v.f。设(u,v)为运行DFS从u探索到的一条边，此时u为灰色。假设v也为灰色，则(u,v)为一条后向边，与G是DAG矛盾，所以v不可能为灰色。当v为白色时，(u,v)是一条树边，v成为u的子节点，根据括号化定理有v.f<u.f；当v为黑色时，v已经处理完毕，而u还没有处理完毕，因为f值是严格单调递增的，而v的f值已经设置，u的f值尚未设置，所以必有u.f>v.f。题设得证。



练习：

![截屏2021-05-30 21.11.46](/Users/wu/Documents/Typora/算法导论图片资源/截屏2021-05-30 21.11.46.png)

![截屏2021-05-30 21.19.15](/Users/wu/Documents/Typora/算法导论图片资源/截屏2021-05-30 21.19.15.png)